#!/bin/bash

API_CONFIG=deploy/environments/production-app/api.yaml.gotmpl
UIX_CONFIG=deploy/environments/production-app/uix.yaml.gotmpl
SEC_CONFIG=deploy/environments/production-app/secrets.yaml

function finish () {
  https --quiet --raw "$CALL" POST rebirthofhope.ru/api/finish/$1
}

# 03 RESOURCE
if grep -q "memory: 8Mi" $API_CONFIG; then
  finish resources
  RESOURCE=true
fi

# 04 LOGS
if grep -q "level: info" $API_CONFIG; then
  finish logs
  LOGS=true
fi

# 05 SECRETS
if ! grep -q "MP7L7goFiZtmRlWPrakbY2Web2rQA+qwjjfUQl1zOgmUU2u477DMt3rcteVQ,iv" $SEC_CONFIG; then
  finish secrets
  SECRETS=true
fi

# 06 REPLICA
if grep -q "replicaCount: 2" $API_CONFIG; then
  finish replicas
  REPLICA=true
fi

# 07 ENVIRONMENTS
if grep -q api.*-apis.rebirthofhope.ru $UIX_CONFIG; then
  finish envs
  ENVIRONMENTS=true
fi

# 08 CORS
if grep -q origins.*uix.rebirthofhope.ru $API_CONFIG; then
  finish cors
  CORS=true
fi

# 09 INGRESS
if grep -q "extraIngress" $API_CONFIG; then
  finish ingress
  INGRESS=true
fi

# 10 VOLUMES
if grep -q "mountPath: /.output/public/arts" $UIX_CONFIG; then
  finish volumes
  VOLUME=true
fi

[[ -z $RESOURCE ]]      && echo "üçÑ RESOURCE"       || echo "üçÄ RESOURCE"
[[ -z $LOGS ]]          && echo "üçÑ LOGS"           || echo "üçÄ LOGS"
[[ -z $SECRETS ]]       && echo "üçÑ SECRETS"        || echo "üçÄ SECRETS"
[[ -z $REPLICA ]]       && echo "üçÑ REPLICA"        || echo "üçÄ REPLICA"
[[ -z $ENVIRONMENTS ]]  && echo "üçÑ ENVIRONMENTS"   || echo "üçÄ ENVIRONMENTS"
[[ -z $CORS ]]          && echo "üçÑ CORS"           || echo "üçÄ CORS"
[[ -z $INGRESS ]]       && echo "üçÑ INGRESS"        || echo "üçÄ INGRESS"
[[ -z $VOLUME ]]        && echo "üçÑ VOLUME"         || echo "üçÄ VOLUMES"
